# ------------------------------------------------------------
# Base Image
# ------------------------------------------------------------
FROM python:3.11-slim

# ------------------------------------------------------------
# Environment Variables
# ------------------------------------------------------------
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# ------------------------------------------------------------
# Set Working Directory
# ------------------------------------------------------------
WORKDIR /app

# ------------------------------------------------------------
# Install System Dependencies
# ------------------------------------------------------------
RUN apt-get update && apt-get install -y \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# ------------------------------------------------------------
# Install uv (fast Python package manager)
# ------------------------------------------------------------
RUN pip install --no-cache-dir uv

# ------------------------------------------------------------
# Copy Dependency Files
# ------------------------------------------------------------
COPY pyproject.toml ./

# ------------------------------------------------------------
# Install Python Dependencies
# ------------------------------------------------------------
RUN uv pip install --system --no-cache .

# ------------------------------------------------------------
# Copy Project Files
# ------------------------------------------------------------
COPY predict.py .
COPY models ./models

# ------------------------------------------------------------
# Create Volume for Persistent Data
# ------------------------------------------------------------
VOLUME ["/app"]

# ------------------------------------------------------------
# Expose API Port
# ------------------------------------------------------------
EXPOSE 8000

# ------------------------------------------------------------
# Run FastAPI Application
# ------------------------------------------------------------
CMD ["uvicorn", "predict:app", "--host", "0.0.0.0", "--port", "8000"]
